{"version":3,"file":"ExponentCamera.web.js","sourceRoot":"","sources":["../src/ExponentCamera.web.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { CSSProperties } from 'react';\nimport { findNodeHandle, View } from 'react-native';\n\nimport { CapturedPicture, MountError, NativeProps, PictureOptions } from './Camera.types';\nimport CameraModule, { CameraType } from './CameraModule/CameraModule';\nimport CameraManager from './ExponentCameraManager.web';\n\nexport default class ExponentCamera extends React.Component<NativeProps> {\n  video?: number | null;\n  camera?: CameraModule;\n  state = { type: null };\n\n  componentWillUnmount() {\n    if (this.camera) {\n      this.camera.unmount();\n    }\n  }\n\n  componentWillReceiveProps(nextProps) {\n    this.updateCameraProps(nextProps);\n  }\n\n  private updateCameraProps = async ({\n    type,\n    zoom,\n    pictureSize,\n    flashMode,\n    autoFocus,\n    // focusDepth,\n    whiteBalance,\n  }: NativeProps) => {\n    const { camera } = this;\n    if (!camera) {\n      return;\n    }\n    await Promise.all([\n      camera.setTypeAsync(type as CameraType),\n      camera.setPictureSize(pictureSize as string),\n      camera.setZoomAsync(zoom as number),\n      camera.setAutoFocusAsync(autoFocus as string),\n      camera.setWhiteBalanceAsync(whiteBalance as string),\n      camera.setFlashModeAsync(flashMode as string),\n      camera.ensureCameraIsRunningAsync(),\n    ]);\n    const actualCameraType = camera.getActualCameraType();\n    if (actualCameraType !== this.state.type) {\n      this.setState({ type: actualCameraType });\n    }\n    this.updateScanner();\n  };\n\n  getCamera = (): CameraModule => {\n    if (this.camera) {\n      return this.camera;\n    }\n    throw new Error('Camera is not defined yet!');\n  };\n\n  getAvailablePictureSizes = async (ratio: string): Promise<string[]> => {\n    const camera = this.getCamera();\n    return camera.getAvailablePictureSizes(ratio);\n  };\n\n  takePicture = async (options: PictureOptions): Promise<CapturedPicture> => {\n    const camera = this.getCamera();\n    return camera.takePicture({\n      ...options,\n      // This will always be defined, the option gets added to a queue in the upper-level. We should replace the original so it isn't called twice.\n      onPictureSaved: this.props.onPictureSaved,\n    });\n  };\n\n  resumePreview = async (): Promise<void> => {\n    const camera = this.getCamera();\n    await camera.resumePreview();\n  };\n\n  pausePreview = (): void => {\n    const camera = this.getCamera();\n    camera.pausePreview();\n  };\n\n  onCameraReady = () => {\n    if (this.props.onCameraReady) {\n      this.props.onCameraReady();\n    }\n  };\n\n  onMountError = ({ nativeEvent }: { nativeEvent: MountError }) => {\n    if (this.props.onMountError) {\n      this.props.onMountError({ nativeEvent });\n    }\n  };\n\n  private setRef = async ref => {\n    if (!ref) {\n      this.video = null;\n      if (this.camera) {\n        this.camera.unmount();\n        this.camera.stopScanner();\n        this.camera = undefined;\n      }\n      return;\n    }\n    this.video = findNodeHandle(ref);\n    this.camera = new CameraModule(ref);\n    this.camera.onCameraReady = this.onCameraReady;\n    this.camera.onMountError = this.onMountError;\n    this.updateCameraCanvas();\n    this.updateCameraProps(this.props);\n  };\n\n  private updateScanner = () => {\n    if (!this.camera) return;\n    const { barCodeScannerSettings, onBarCodeScanned } = this.props;\n    if (onBarCodeScanned && barCodeScannerSettings) {\n      this.camera.startScanner(\n        {\n          // Default barcode scanning update interval, same as is defined in the API layer.\n          // TODO: Bacon: Make this larger for low-end devices.\n          interval: this.shouldRenderIndicator() ? -1 : 500,\n          ...barCodeScannerSettings,\n        },\n        nativeEvent => {\n          if (this.props.onBarCodeScanned) {\n            this.props.onBarCodeScanned({ nativeEvent });\n            return;\n          }\n          this.updateScanner();\n        }\n      );\n    }\n  };\n\n  canvas?: HTMLCanvasElement;\n\n  private setCanvasRef = ref => {\n    this.canvas = ref;\n    this.updateCameraCanvas();\n  };\n\n  private updateCameraCanvas() {\n    if (this.camera) {\n      this.camera.canvas = this.canvas;\n    }\n  }\n\n  private shouldRenderIndicator = (): boolean => {\n    if (this.props.barCodeScannerSettings) {\n      return this.props.barCodeScannerSettings.shouldRenderIndicator || false;\n    }\n    return false;\n  };\n\n  render() {\n    const transform = this.state.type === CameraManager.Type.front ? 'rotateY(180deg)' : 'none';\n    return (\n      <View style={[{ flex: 1, alignItems: 'stretch' }, this.props.style]}>\n        <video ref={this.setRef} style={{ ...videoStyle, transform }} autoPlay playsInline />\n        {this.shouldRenderIndicator() && <canvas ref={this.setCanvasRef} style={canvasStyle} />}\n        {this.props.children}\n      </View>\n    );\n  }\n}\n\nconst videoStyle: CSSProperties = {\n  position: 'absolute',\n  top: 0,\n  left: 0,\n  right: 0,\n  bottom: 0,\n  width: '100%',\n  height: '100%',\n  objectFit: 'cover',\n};\n\nconst canvasStyle: CSSProperties = {\n  position: 'absolute',\n  top: 0,\n  left: 0,\n  right: 0,\n  bottom: 0,\n  width: '100%',\n  height: '100%',\n};\n"]}